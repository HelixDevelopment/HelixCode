<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3 API Reference - HelixCode</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .api-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .api-header {
            text-align: center;
            margin-bottom: 60px;
        }
        .api-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
        }
        .api-subtitle {
            font-size: 1.5rem;
            color: #666;
        }
        .api-section {
            margin: 60px 0;
        }
        .api-section h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #6b46ff;
            padding-bottom: 10px;
        }
        .api-section h3 {
            font-size: 1.5rem;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #6b46ff;
        }
        .api-section h4 {
            font-size: 1.2rem;
            margin-top: 25px;
            margin-bottom: 10px;
        }
        .code-example {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            white-space: pre;
        }
        .api-content {
            background: #fff;
            padding: 30px;
            margin: 20px 0;
            border-radius: 4px;
            line-height: 1.8;
        }
        .toc {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 30px 0;
        }
        .toc h3 {
            margin-top: 0;
        }
        .toc ul {
            list-style: none;
            padding-left: 20px;
        }
        .toc li {
            padding: 5px 0;
        }
        .toc a {
            color: #6b46ff;
            text-decoration: none;
        }
        .toc a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <a href="index.html"><span class="logo-helix">Helix</span><span class="logo-code">Code</span></a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="PHASE_3_FEATURES.html">Phase 3 Features</a></li>
                <li><a href="PHASE_3_QUICK_REFERENCE.html">Quick Reference</a></li>
                <li><a href="manual/">Manual</a></li>
            </ul>
        </div>
    </nav>

    <div class="api-container">
        <div class="api-header">
            <h1 class="api-title">Phase 3 API Reference</h1>
            <p class="api-subtitle">Complete API documentation for all Phase 3 features</p>
        </div>

        <div class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#session-management">1. Session Management</a></li>
                <li><a href="#memory-system">2. Memory System</a></li>
                <li><a href="#state-persistence">3. State Persistence</a></li>
                <li><a href="#template-system">4. Template System</a></li>
                <li><a href="#error-handling">Error Handling</a></li>
                <li><a href="#thread-safety">Thread Safety</a></li>
                <li><a href="#best-practices">Best Practices</a></li>
            </ul>
        </div>

        <section class="api-section" id="session-management">
            <h2>Session Management</h2>
            <p><strong>Package:</strong> <code>dev.helix.code/internal/session</code></p>

            <h3>Types</h3>

            <h4>Mode</h4>
            <div class="code-example">type Mode string

const (
    ModePlanning    Mode = "planning"     // Design and architecture
    ModeBuilding    Mode = "building"     // Implementation
    ModeTesting     Mode = "testing"      // Quality assurance
    ModeRefactoring Mode = "refactoring"  // Code improvement
    ModeDebugging   Mode = "debugging"    // Issue investigation
    ModeDeployment  Mode = "deployment"   // Release preparation
)</div>

            <h4>Status</h4>
            <div class="code-example">type Status string

const (
    StatusIdle      Status = "idle"       // Created but not started
    StatusActive    Status = "active"     // Currently running
    StatusPaused    Status = "paused"     // Temporarily stopped
    StatusCompleted Status = "completed"  // Successfully finished
    StatusFailed    Status = "failed"     // Ended with failure
)</div>

            <h4>Session</h4>
            <div class="code-example">type Session struct {
    ID          string            // Unique identifier
    Name        string            // Human-readable name
    Mode        Mode              // Session mode
    Status      Status            // Current status
    ProjectID   string            // Associated project
    Tags        []string          // Searchable tags
    Metadata    map[string]string // Custom metadata
    Context     map[string]string // Session context data
    CreatedAt   time.Time         // Creation timestamp
    StartedAt   time.Time         // Start timestamp
    EndedAt     time.Time         // End timestamp
    LastPausedAt time.Time        // Last pause timestamp
}</div>

            <h3>Manager</h3>

            <h4>Creation</h4>
            <div class="code-example">func NewManager() *Manager</div>
            <p>Creates a new session manager.</p>
            <div class="code-example">mgr := session.NewManager()</div>

            <h4>Create Session</h4>
            <div class="code-example">func (m *Manager) Create(name string, mode Mode, projectID string) (*Session, error)</div>
            <p><strong>Parameters:</strong></p>
            <ul>
                <li><code>name</code>: Session name</li>
                <li><code>mode</code>: Session mode (planning, building, etc.)</li>
                <li><code>projectID</code>: Associated project ID</li>
            </ul>
            <div class="code-example">sess, err := mgr.Create("implement-auth", session.ModeBuilding, "api-server")
if err != nil {
    log.Fatal(err)
}</div>

            <h4>Session Lifecycle</h4>
            <div class="code-example">func (m *Manager) Start(id string) error     // idle → active
func (m *Manager) Pause(id string) error     // active → paused
func (m *Manager) Resume(id string) error    // paused → active
func (m *Manager) Complete(id string) error  // active → completed
func (m *Manager) Fail(id string, reason string) error  // active → failed</div>

            <h4>Query Methods</h4>
            <div class="code-example">func (m *Manager) Get(id string) (*Session, error)
func (m *Manager) GetAll() []*Session
func (m *Manager) GetByProject(projectID string) []*Session
func (m *Manager) GetByMode(mode Mode) []*Session
func (m *Manager) GetByStatus(status Status) []*Session
func (m *Manager) GetByTag(tag string) []*Session
func (m *Manager) GetRecent(limit int) []*Session
func (m *Manager) FindByName(name string) []*Session
func (m *Manager) Count() int
func (m *Manager) CountByStatus() map[Status]int</div>

            <h4>Export/Import</h4>
            <div class="code-example">// Export
snapshot, err := mgr.Export(sess.ID)
data, _ := json.Marshal(snapshot)

// Import
var snapshot session.SessionSnapshot
json.Unmarshal(data, &snapshot)
mgr.Import(&snapshot)</div>

            <h4>Callbacks</h4>
            <div class="code-example">mgr.OnCreate(func(s *session.Session) {
    log.Printf("Session created: %s\n", s.Name)
})</div>
        </section>

        <section class="api-section" id="memory-system">
            <h2>Memory System</h2>
            <p><strong>Package:</strong> <code>dev.helix.code/internal/memory</code></p>

            <h3>Types</h3>

            <h4>Role</h4>
            <div class="code-example">type Role string

const (
    RoleUser      Role = "user"      // User messages
    RoleAssistant Role = "assistant" // AI assistant messages
    RoleSystem    Role = "system"    // System/context messages
)</div>

            <h4>Message</h4>
            <div class="code-example">type Message struct {
    ID        string            // Unique identifier
    Role      Role              // Message role
    Content   string            // Message content
    Metadata  map[string]string // Custom metadata
    Tokens    int               // Estimated token count
    CreatedAt time.Time         // Creation timestamp
}</div>

            <h4>Conversation</h4>
            <div class="code-example">type Conversation struct {
    ID        string            // Unique identifier
    Title     string            // Conversation title
    SessionID string            // Associated session ID
    Metadata  map[string]string // Custom metadata
    CreatedAt time.Time         // Creation timestamp
    UpdatedAt time.Time         // Last update timestamp
}</div>

            <h3>Message Creation</h3>
            <div class="code-example">msg := memory.NewUserMessage("Help me debug this code")
msg.SetMetadata("file", "main.go")</div>

            <h3>Manager</h3>

            <h4>Create Conversation</h4>
            <div class="code-example">conv := mgr.CreateConversation("Feature Implementation")
conv.SessionID = "session-123"</div>

            <h4>Add Message</h4>
            <div class="code-example">mgr.AddMessage(conv.ID, memory.NewUserMessage("Hello"))</div>

            <h4>Query Methods</h4>
            <div class="code-example">func (m *Manager) GetAll() []*Conversation
func (m *Manager) GetBySession(sessionID string) []*Conversation
func (m *Manager) GetRecent(limit int) []*Conversation
func (m *Manager) Search(query string) []*Conversation
func (m *Manager) SearchMessages(query string) []*Message
func (m *Manager) TotalMessages() int
func (m *Manager) TotalTokens() int</div>

            <h4>Limits</h4>
            <div class="code-example">mgr.SetMaxMessages(500)
mgr.SetMaxTokens(50000)
mgr.TrimConversations(50)  // Keep last 50 conversations</div>

            <h3>Conversation Methods</h3>
            <div class="code-example">// Get recent messages
recent := conv.GetRecent(10)

// Search
results := conv.Search("authentication")

// Token management
conv.SetMaxTokens(10000)
total := conv.TotalTokens()

// Export as text
text := conv.ToText()</div>
        </section>

        <section class="api-section" id="state-persistence">
            <h2>State Persistence</h2>
            <p><strong>Package:</strong> <code>dev.helix.code/internal/persistence</code></p>

            <h3>Types</h3>
            <div class="code-example">type Format string

const (
    FormatJSON        Format = "json"         // Human-readable JSON
    FormatCompactJSON Format = "compact-json" // Compact JSON
    FormatJSONGZIP    Format = "json-gzip"    // Compressed JSON
)</div>

            <h3>Store Creation</h3>
            <div class="code-example">store := persistence.NewStore("./helixcode_data")</div>

            <h3>Configuration</h3>
            <div class="code-example">store.SetSessionManager(sessionMgr)
store.SetMemoryManager(memoryMgr)
store.SetFormat(persistence.FormatJSONGZIP)</div>

            <h3>Save/Load Operations</h3>
            <div class="code-example">// Save everything
if err := store.Save(); err != nil {
    log.Fatal(err)
}

// Load everything
if err := store.Load(); err != nil {
    log.Println("No previous state found")
}</div>

            <h3>Auto-Save</h3>
            <div class="code-example">// Enable auto-save every 5 minutes
store.EnableAutoSave(300)

// Check status
if store.IsAutoSaveEnabled() {
    interval := store.GetAutoSaveInterval()
    fmt.Printf("Auto-save every %d seconds\n", interval)
}

// Disable
store.DisableAutoSave()</div>

            <h3>Backup and Restore</h3>
            <div class="code-example">// Create backup
backupPath := fmt.Sprintf("./backups/backup-%s", time.Now().Format("20060102-150405"))
if err := store.Backup(backupPath); err != nil {
    log.Fatal(err)
}

// Restore from backup
if err := store.Restore(backupPath); err != nil {
    log.Fatal(err)
}</div>

            <h3>Callbacks</h3>
            <div class="code-example">store.OnSave(func() {
    log.Println("State saved successfully")
})

store.OnError(func(err error) {
    log.Printf("Persistence error: %v\n", err)
})</div>
        </section>

        <section class="api-section" id="template-system">
            <h2>Template System</h2>
            <p><strong>Package:</strong> <code>dev.helix.code/internal/template</code></p>

            <h3>Types</h3>
            <div class="code-example">type Type string

const (
    TypeCode          Type = "code"          // Code generation
    TypePrompt        Type = "prompt"        // AI prompts
    TypeWorkflow      Type = "workflow"      // Process templates
    TypeDocumentation Type = "documentation" // Documentation
    TypeEmail         Type = "email"         // Email templates
    TypeCustom        Type = "custom"        // Custom use
)</div>

            <h3>Template Creation</h3>
            <div class="code-example">tpl := template.NewTemplate(
    "API Handler",
    "Generate HTTP handler",
    template.TypeCode,
)

tpl.SetContent(`func {{name}}() {{return_type}} {
    {{body}}
}`)

tpl.AddVariable(template.Variable{
    Name:     "name",
    Required: true,
    Type:     "string",
})

result, err := tpl.Render(map[string]interface{}{
    "name": "ProcessData",
    "body": "return nil",
})</div>

            <h3>Manager</h3>

            <h4>Register Template</h4>
            <div class="code-example">if err := mgr.Register(tpl); err != nil {
    log.Fatal(err)
}</div>

            <h4>Render</h4>
            <div class="code-example">result, err := mgr.RenderByName("Function", map[string]interface{}{
    "function_name": "ProcessData",
    "parameters":    "data []byte",
    "return_type":   "error",
    "body":          "return nil",
})</div>

            <h4>Query Methods</h4>
            <div class="code-example">tpl, err := mgr.GetByName("Function")
codeTpls := mgr.GetByType(template.TypeCode)
results := mgr.Search("handler")
total := mgr.Count()</div>

            <h4>Built-in Templates</h4>
            <div class="code-example">if err := mgr.RegisterBuiltinTemplates(); err != nil {
    log.Fatal(err)
}</div>
            <p>Registers 5 built-in templates: Function, Code Review, Bug Fix, Function Documentation, Status Update Email.</p>
        </section>

        <section class="api-section" id="error-handling">
            <h2>Error Handling</h2>
            <p>All methods that can fail return an <code>error</code> type. Always check errors:</p>
            <div class="code-example">sess, err := sessionMgr.Create("name", session.ModeBuilding, "project")
if err != nil {
    log.Fatalf("Failed to create session: %v", err)
}</div>
            <p><strong>Common error types:</strong></p>
            <ul>
                <li><code>ErrNotFound</code> - Resource not found</li>
                <li><code>ErrValidation</code> - Validation failed</li>
                <li><code>ErrConflict</code> - Duplicate or conflicting resource</li>
                <li><code>ErrState</code> - Invalid state transition</li>
            </ul>
        </section>

        <section class="api-section" id="thread-safety">
            <h2>Thread Safety</h2>
            <p>All managers are thread-safe and can be used concurrently:</p>
            <ul>
                <li>Protected with <code>sync.RWMutex</code></li>
                <li>Safe for concurrent reads</li>
                <li>Safe for concurrent writes</li>
                <li>No external synchronization needed</li>
            </ul>
        </section>

        <section class="api-section" id="best-practices">
            <h2>Best Practices</h2>
            <ol>
                <li><strong>Always check errors</strong> - Never ignore error return values</li>
                <li><strong>Use contexts</strong> - Store relevant data in metadata and context fields</li>
                <li><strong>Set limits</strong> - Configure max messages/tokens to prevent unbounded growth</li>
                <li><strong>Enable auto-save</strong> - Prevent data loss with automatic persistence</li>
                <li><strong>Clean up</strong> - Delete or archive old sessions and conversations</li>
                <li><strong>Use callbacks</strong> - Monitor events for logging and analytics</li>
                <li><strong>Tag everything</strong> - Makes searching and filtering easier</li>
                <li><strong>Export important work</strong> - Backup sessions, conversations, and templates</li>
            </ol>
        </section>

        <div style="text-align: center; margin: 60px 0;">
            <a href="PHASE_3_QUICK_REFERENCE.html" class="btn btn-primary btn-large">Quick Reference</a>
            <a href="PHASE_3_FEATURES.html" class="btn btn-outline btn-large">Phase 3 Features</a>
            <a href="../examples/phase3/" class="btn btn-outline btn-large">Example Projects</a>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="footer-title">HelixCode</h3>
                    <p>Enterprise AI Development Platform</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 HelixCode. Open source under MIT License.</p>
            </div>
        </div>
    </footer>
</body>
</html>
